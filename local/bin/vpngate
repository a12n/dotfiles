#!/usr/bin/env python

import base64
import csv
import sys
import urllib

from subprocess import PIPE, Popen

for v in csv.reader(urllib.urlopen("http://www.vpngate.net/api/iphone/")):
    if v[0].startswith("#") or v[0].startswith("*"):
        continue
    if v[6] in sys.argv[1:] or v[1] in sys.argv[1:]:
        print "\33[33m====", v[1], v[5], "====\33[0m"
        continue
    print "\33[34m====", v[1], v[5], "====\33[0m"
    openvpn = Popen(["sudo", "openvpn", "/dev/stdin"], stdin=PIPE)
    openvpn.stdin.write(base64.b64decode(v[14]))
    openvpn.stdin.close()
    openvpn.wait()
